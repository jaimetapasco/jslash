var jslash={};
(function(){function d(a,b){var c=a.prototype.constructor;a.prototype=b;a.prototype.constructor=c}function i(){this.message="This method must be implemented.";this.name="NotImplementedError"}function g(){throw new i;}function k(a,b){a.images=[];jslash.each(b,function(b,c){jslash.prefetchImg(c);a.images.push(jslash.images[c])});var c=setInterval(function(){var b=true;jslash.each(a.images,function(a,c){b=b&&c.complete});if(b)a._ready=true,clearInterval(c)},s)}function p(a,b,c){f(c)||(c=null);for(var e=
[],x=0;x<a;x++){var d=[];e.push(d);for(var g=0;g<b;g++)d.push(c)}return e}function y(a,b){var c=b.map;a.orientation=c.orientation;a.properties=c.properties;a.tileheight=parseFloat(c.tileheight);a.tilewidth=parseFloat(c.tilewidth);a.width=parseFloat(c.width);a.height=parseFloat(c.height);for(var e=[],d=[],h=[],g=0;g<b.images.length;g++){var r=b.images[g],j=b.tilesets[g];h.push({tilesPerWidth:l.div(r.width,j.tilewidth),tileheight:parseFloat(j.tileheight),tilewidth:parseFloat(j.tilewidth)});e.push(r.source);
delete j.name;d.push(j)}k(a,e);a.layers=[];a.obstacles=p(c.height,c.width,false);jslash.each(b.layers,function(b,e){var g=p(c.height,c.width);g.properties=e.properties;if(g.properties&&g.properties.obstacle)g.obstacles=p(c.height,c.width);a.layers.push(g);for(var j=0;j<e.data.length;j++){for(var r=l.div(j,c.width),k=j%c.width,i=e.data[j],n,m=void 0,o=null,q=d.length-1;q>=0;q--)if(n=d[q],n.firstgid<=i){m=q;break}f(m)&&(i-=n.firstgid,o=h[m],q=l.div(i,o.tilesPerWidth)*o.tileheight,o=new jslash.Frame(a.images[m],
new jslash.Rect(i%o.tilesPerWidth*o.tilewidth,q,o.tilewidth,o.tileheight)));g[r][k]=o;g.obstacles&&(g.obstacles[r][k]=o!=null)}})}function f(a){return a!=void 0}function D(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}function z(a){a=document.createElement(a);document.body.appendChild(a);return a}function E(){A||(window.addEventListener("keydown",
function(a){a.keyCode in n&&jslash.each(n[a.keyCode],function(a,c){c()})},true),A=true)}function B(a){var b=[];jslash.each(a,function(a,e){b.push(a+"=");b.push(encodeURIComponent(e));b.push("&")});b.pop();return b.join("")}d(i,Error());jslash.Rectangle=function(a,b,c,e){this.x=a;this.y=b;this.width=c;this.height=e};jslash.Rect=jslash.Rectangle;jslash.Rectangle.prototype.center=function(a,b){var c=(2*this.x+this.width)/2,e=(2*this.y+this.height)/2;if(!f(a)||!f(b))return new jslash.Point(c,e);this.x+=
a-c;this.y+=b-e};jslash.Rectangle.prototype.points=function(){return[new jslash.Point(this.x,this.y),new jslash.Point(this.x+this.width,this.y),new jslash.Point(this.x,this.y+this.height),new jslash.Point(this.x+this.width,this.y+this.height)]};jslash.Rectangle.prototype.contains=function(a){return a.x>=this.x&&a.x<=this.x+this.width&&a.y>=this.y&&a.y<=this.y+this.height};jslash.Rectangle.prototype.toSizeable=function(){var a=this;return{width:function(){return a.width},height:function(){return a.height}}};
jslash.Rectangle.collide=function(a,b){return a.points().some(function(a){return b.contains(a)})||b.points().some(function(b){return a.contains(b)})};jslash.BorderedRectangle=function(){jslash.Rectangle.apply(this,arguments)};d(jslash.BorderedRectangle,new jslash.Rectangle);jslash.BorderedRectangle.collide=function(a,b){var c=a.x+a.width,e=a.y+a.height,f=b.x+b.width,d=b.y+b.height;return a.x>=b.x&&a.x<=f||a.y>=b.y&&a.y<=d||c>=b.x&&c<=f||e>=b.y&&e<=d};jslash.Point=function(a,b){this.x=a;this.y=b};
jslash.Canvas=function(a){if(!f(a)){a=z("div");a.id="canvasDiv"+C;var b=document.createElement("canvas");b.id="canvas"+C++;a.appendChild(b);a=b.id}this._canvas=jslash.byId(a);this.context=this._canvas.getContext("2d")};jslash.Canvas.prototype.draw=function(a){if(a.onrefresh)a.onrefresh();a.draw&&a.draw(this.context)};jslash.Canvas.prototype.fill=function(a){this.context.fillStyle=a.toString();this.context.fillRect(0,0,this._canvas.width,this._canvas.height)};jslash.Canvas.prototype.center=function(){return(new jslash.Rect(0,
0,this._canvas.width,this._canvas.height)).center()};jslash.Canvas.prototype.width=function(a){if(!f(a))return this._canvas.width;this._canvas.width=a};jslash.Canvas.prototype.height=function(a){if(!f(a))return this._canvas.height;this._canvas.height=a};jslash.Canvas.prototype.bind=function(a,b){var c=this._canvas;c.addEventListener(a,function(a){var f={};f.x=a.clientX-c.offsetLeft;f.y=a.clientY-c.offsetTop;b(f)},true)};jslash.BaseSprite=function(){this.alpha=1};jslash.BaseSprite.prototype.center=
function(a,b){var c=this.canvasRect().center(a,b);if(f(c))return c};jslash.BaseSprite.prototype.width=function(){return this.canvasRect().width};jslash.BaseSprite.prototype.height=function(){return this.canvasRect().height};jslash.BaseSprite.prototype.image=g;jslash.BaseSprite.prototype.imageRect=g;jslash.BaseSprite.prototype.canvasRect=g;jslash.BaseSprite.prototype.draw=function(a){var b=f(this.angle),c=this.imageRect(),e=this.canvasRect();a.save();a.globalAlpha=this.alpha;b?(a.translate(e.x+e.width/
2,e.y+e.height/2),a.rotate(this.angle),a.drawImage(this.image(),c.x,c.y,c.width,c.height,-e.width/2,-e.height/2,e.width,e.height)):a.drawImage(this.image(),c.x,c.y,c.width,c.height,e.x,e.y,e.width,e.height);a.restore()};jslash.BaseSprite.prototype.scale=function(a){var b=this.canvasRect();b.width*=a;b.height*=a;this._canvasSubrect=b};jslash.BaseSprite.prototype.rotate=function(a){if(!f(this.angle))this.angle=0;this.angle+=a};jslash.Sprite=function(a,b){jslash.BaseSprite.apply(this);this._img=a;var c=
f(b)?b.x:0,e=f(b)?b.y:0;this._canvasSubrect=new jslash.Rectangle(c,e,a.width,a.height);this._imageSubrect=new jslash.Rectangle(0,0,a.width,a.height)};d(jslash.Sprite,new jslash.BaseSprite);jslash.Sprite.prototype.image=function(){return this._img};jslash.Sprite.prototype.imageRect=function(a){if(!f(a))return this._imageSubrect;this._imageSubrect=jslash.deepcopy(a)};jslash.Sprite.prototype.canvasRect=function(a){if(!f(a))return this._canvasSubrect;this._canvasSubrect=jslash.deepcopy(a)};jslash.Sprite.prototype.position=
function(a,b){if(!f(a)||!f(b))return new jslash.Point(this._canvasSubrect.x,this._canvasSubrect.y);this._canvasSubrect.x=a;this._canvasSubrect.y=b};jslash.Frame=function(a,b){this._img=a;this._subrect=b};jslash.Frame.prototype.image=function(){return this._img};jslash.Frame.prototype.rect=function(){return this._subrect};jslash.AnimatedSprite=function(a){jslash.BaseSprite.apply(this);this._frames=a;this._currentFrame=0};d(jslash.AnimatedSprite,new jslash.BaseSprite);jslash.AnimatedSprite.makeRefresh=
function(a){f(a)||(a=10);var b=0;return function(){b==a?(b=0,this.next()):b++}};jslash.AnimatedSprite.prototype.next=function(){this._currentFrame=(this._currentFrame+1)%this._frames.length};jslash.AnimatedSprite.prototype.image=function(){return this._frames[this._currentFrame].image()};jslash.AnimatedSprite.prototype.imageRect=function(){return this._frames[this._currentFrame].rect()};jslash.AnimatedSprite.prototype.canvasRect=function(a){if(!f(a)){if(!f(this._canvasSubrect))this._canvasSubrect=
jslash.deepcopy(this._frames[this._currentFrame].rect());return this._canvasSubrect}this._canvasSubrect=a};jslash.AnimatedSprite.prototype.position=function(a,b){if(!f(a)||!f(b)){var c=this.canvasRect();return new jslash.Point(c.x,c.y)}f(this._canvasSubrect)||this.canvasRect(jslash.deepcopy(this.canvasRect()));this._canvasSubrect.x=a;this._canvasSubrect.y=b};jslash.CompositeSprite=function(){jslash.BaseSprite.apply(this);var a=arguments.length,b=a-1,c;b>0&&arguments[b]instanceof jslash.Canvas?c=arguments[b]:
(b++,f(m)||(m=new jslash.Canvas,m._canvas.style.setProperty("display","none","")),c=m);c.fill(jslash.colorkey);for(var e=0,d=0,h=0;h<b;h++){var g=arguments[h],i=g.width(),j=g.height();e<i&&(e=i);d<j&&(d=j);c.draw(g)}this._imgData=a>0?c.context.getImageData(0,0,e,d):null;if(this._imgData!=null){i=this._imgData.width;j=this._imgData.height;for(a=0;a<i;a++)for(c=0;c<j;c++)if(h=b=a*i*4+c*4,(new jslash.Color(this._imgData.data[h++],this._imgData.data[h++],this._imgData[h++],this._imgData[h++])).equals(jslash.colorkey))for(;b<
h;b++)this._imgData.data[b]=0}this.x=this.y=0};d(jslash.CompositeSprite,new jslash.BaseSprite);jslash.CompositeSprite.prototype.position=function(a,b){if(!f(a)||!f(b))return new jslash.Point(this.x,this.y);this.x=a;this.y=b};jslash.CompositeSprite.prototype.draw=function(a){a.putImageData(this._imgData,this.x,this.y)};jslash.Text=function(a,b,c){this.text=a||"";this.font="Arial";this.color="black";this.weight="";this.size=12;this.x=f(b)?b:0;this.y=f(c)?c:0};jslash.Text.prototype.draw=function(a){a.save();
a.fillStyle=this.color.toString();a.font=[this.weight,this.size,this.font].join(" ").trim();a.fillText(this.text,this.x,this.y+this.size);a.restore()};jslash.Text.prototype.width=function(a){a=a.context;a.save();a.fillStyle=this.color;a.font=[this.weight,this.size,this.font].join(" ");var b=a.measureText(this.text).width;a.restore();return b};jslash.Text.prototype.height=function(){return this.size};jslash.Audio=function(a){f(a)?a=jslash.byId(a):(a=z("audio"),a.id="audio"+F++);this._audio=a};jslash.Audio.prototype.load=
function(a){this._audio.src=a};jslash.Audio.prototype.isReady=function(){return this._audio.readyState};jslash.Audio.prototype.play=function(){this._audio.play()};jslash.Audio.prototype.stop=function(){this._audio.pause();this._audio.currentTime=0};jslash.Audio.prototype.isPlaying=function(){return!this._audio.paused};jslash.Audio.prototype.pause=function(){this._audio.pause()};jslash.Audio.prototype.resume=function(){this._audio.play()};jslash.Audio.prototype.volume=function(a){if(!a)return this._audio.volume;
this._audio.volume=a};jslash.Audio.prototype.ready=function(a){var b=this._audio,c=setInterval(function(){b.readyState&&(a(),clearInterval(c))},s)};jslash.Color=function(a,b,c,e){this.r=a;this.g=b;this.b=c;this.a=f(e)?e:1};jslash.Color.prototype.equals=function(a){return this.r==a.r&&this.g==a.g&&this.b==a.b&&this.a==a.a};jslash.Color.prototype.toString=function(){return"rgba("+[this.r,this.g,this.b,this.a].join(",")+")"};jslash.BaseTileset=function(){this.firstrow=this.firstcol=0;this.alpha=1};jslash.BaseTileset.prototype.scrollDown=
function(a){return(this.firstrow+1)*this.tileheight+a.height()<=this.pixelsHeight()?(this.firstrow++,true):false};jslash.BaseTileset.prototype.canScrollDown=function(a){return(this.firstrow+1)*this.tileheight+a.height()<=this.pixelsHeight()};jslash.BaseTileset.prototype.scrollRight=function(a){return(this.firstcol+1)*this.tilewidth+a.width()<=this.pixelsWidth()?(this.firstcol++,true):false};jslash.BaseTileset.prototype.canScrollRight=function(a){return(this.firstcol+1)*this.tilewidth+a.width()<=this.pixelsWidth()};
jslash.BaseTileset.prototype.scrollUp=function(){return this.firstrow>0?(this.firstrow--,true):false};jslash.BaseTileset.prototype.canScrollUp=function(){return this.firstrow>0};jslash.BaseTileset.prototype.scrollLeft=function(){return this.firstcol>0?(this.firstcol--,true):false};jslash.BaseTileset.prototype.canScrollLeft=function(){return this.firstcol>0};jslash.BaseTileset.prototype.pixelsWidth=function(){return this.width*this.tilewidth};jslash.BaseTileset.prototype.pixelsHeight=function(){return this.height*
this.tileheight};jslash.BaseTileset.prototype.toRelative=function(a){a=jslash.deepcopy(a);a.x-=this.firstcol*this.tilewidth;a.y-=this.firstrow*this.tileheight;return a};jslash.BaseTileset.prototype.toAbsolute=function(a){a=jslash.deepcopy(a);a.x+=this.firstcol*this.tilewidth;a.y+=this.firstrow*this.tileheight;return a};jslash.BaseTileset.prototype.toCell=function(a){var b=this.firstrow,c=this.firstcol;c+=l.div(a.x,this.tilewidth);b+=l.div(a.y,this.tileheight);return{row:b,col:c}};jslash.BaseTileset.prototype.putObstacleOn=
g;jslash.BaseTileset.prototype.cellIsObstacle=g;jslash.BaseTileset.prototype.isFreeArea=function(a){for(var b=a.y;b<=a.y+a.height;b+=this.tileheight)for(var c=a.x;c<=a.x+a.width;c+=this.tilewidth){var e=l.div(b,this.tileheight),f=l.div(c,this.tilewidth);if(this.cellIsObstacle(e,f))return false}return true};jslash.BaseTileset.prototype.canvasRect=function(a){if(f(a))this._canvasRect=a;return this._canvasRect};jslash.TiledTileset=function(a){jslash.BaseTileset.apply(this);this._ready=false;if(f(a)){typeof a==
"string"&&(a=JSON.parse(a));if(typeof a!="object")throw Error("the argument should be an string or an object");y(this,a)}};d(jslash.TiledTileset,new jslash.BaseTileset);jslash.TiledTileset.prototype.load=function(a){var b=this;(new jslash.net.Request(a,"GET")).send(function(a){a=JSON.parse(a);y(b,a)})};jslash.TiledTileset.prototype.draw=function(a){a.save();a.globalAlpha=this.alpha;var b=f(this._canvasRect)?this._canvasRect.width:a.canvas.width,c=f(this._canvasRect)?this._canvasRect.height:a.canvas.height,
e=f(this._canvasRect)?this._canvasRect.x:0,d=f(this._canvasRect)?this._canvasRect.y:0,h=this;jslash.each(this.layers,function(f,g){for(var j,i=h.firstrow,k=d;k<c&&i<h.height;k+=h.tileheight,i++){j=h.firstcol;for(var m=e;m<b&&j<h.width;m+=h.tilewidth,j++){var n=g[i][j];if(n){var l=n.rect();a.drawImage(n.image(),l.x,l.y,l.width,l.height,m,k,l.width,l.height)}}}});a.restore()};jslash.TiledTileset.prototype.cellIsObstacle=function(a,b){if(a>=0&&a<this.obstacles.length&&b>=0&&b<this.obstacles[0].length&&
this.obstacles[a][b])return true;var c=false,e=this;jslash.each(this.layers,function(d,g){f(g.obstacles)&&(c=a>=0&&b>=0&&b<e.width&&a<e.height?c||g.obstacles[a][b]:true)});return c};jslash.TiledTileset.prototype.ready=function(a){var b=this,c=setInterval(function(){b._ready&&(a(),clearInterval(c))},s)};jslash.TiledTileset.prototype.putObstacleOn=function(a,b){this.obstacles[a][b]=true};jslash.Animation=function(a,b,c,e){this._boundProp=b;this._boundObj=a;this._time=c;this._transform=e};jslash.Animation.prototype.from=
function(a){this._from=a;return this};jslash.Animation.prototype.to=function(a){this._to=a;return this};jslash.Animation.prototype.start=function(){var a=this;if(f(this._transform))c=setInterval(function(){a._boundObj[a._boundProp]=a._transform(a._boundObj,a._boundObj[a._boundProp])},t),setTimeout(function(){clearInterval(c)},this._time);else{if(!f(this._to)||!f(this._from))throw Error("from and to methods must have been called previously");var b=(this._to-this._from)/(this._time/t);this._boundObj[this._boundProp]=
this._from;var c=setInterval(function(){a._boundObj[a._boundProp]+=b;if(a._boundObj[a._boundProp]>=a._to)a._boundObj[a._boundProp]=a._to,clearInterval(c)},t)}};jslash.Gradient=function(a,b){this.startPoint=a;this.endPoint=b;this._canvasRect=new jslash.Rectangle(a.x,a.y,b.x-a.x,b.y-a.y);this._intermediateColors=[]};jslash.Gradient.prototype.startColor=function(a){this._startColor=a;return this};jslash.Gradient.prototype.endColor=function(a){this._endColor=a;return this};jslash.Gradient.prototype.colorAt=
function(a,b){this._intermediateColors.push({at:a,color:b});return this};jslash.Gradient.prototype.startRadius=function(a){this._startRadius=a;return this};jslash.Gradient.prototype.endRadius=function(a){this._endRadius=a;return this};jslash.Gradient.prototype.radius=function(a){this._startRadius=this.endRadius=a;return this};jslash.Gradient.prototype.canvasRect=function(a){if(!f(a))return this._canvasRect;this._canvasRect=a};jslash.Gradient.prototype.build=function(a){var a=a.context,b=this;if(f(this._startRadius)||
f(this._endRadius)){if(!f(this._startRadius))this._startRadius=this._endRadius;if(!f(this._endRadius))this._endRadius=this._startRadius;this._gradient=a.createRadialGradient(this.startPoint.x,this.startPoint.y,this._startRadius,this.endPoint.x-this.startPoint.x,this.endPoint.y-this.startPoint.y,this._endRadius)}else this._gradient=a.createLinearGradient(this.startPoint.x,this.startPoint.y,this.endPoint.x-this.startPoint.x,this.endPoint.y-this.startPoint.y);this._gradient.addColorStop(0,this._startColor);
jslash.each(this._intermediateColors,function(a,e){b._gradient.addColorStop(e.at,e.color)});this._gradient.addColorStop(1,this._endColor);return this};jslash.Gradient.prototype.draw=function(a){a.fillStyle=this._gradient;a.fillRect(this._canvasRect.x,this._canvasRect.y,this._canvasRect.width,this._canvasRect.height)};jslash.ProgressBar=function(a,b){this.x=a;this.y=b};jslash.ProgressBar.prototype.borderColor=function(a){this._borderColor=a;return this};jslash.ProgressBar.prototype.borderWidth=function(a){this._borderWidth=
a;return this};jslash.ProgressBar.prototype.backgroundColor=function(a){this._backgroundColor=a;return this};jslash.ProgressBar.prototype.width=function(a){this._width=a;return this};jslash.ProgressBar.prototype.height=function(a){this._height=a;return this};jslash.ProgressBar.prototype.draw=function(a){var b=u/v;a.save();b*=this._width-this._borderWidth*2;a.fillStyle=this._backgroundColor.toString();a.fillRect(this.x+this._borderWidth,this.y+this._borderWidth,b,this._height-this._borderWidth*2);
a.restore();a.save();a.strokeStyle=this._borderColor.toString();a.lineWidth=this._borderWidth;a.strokeRect(this.x,this.y,this._width,this._height);a.restore()};var C=0,F=0,m,n={},A,w=false,u=0,v=0,s=25,t=50;jslash.KEYS={UP:38,LEFT:37,RIGHT:39,DOWN:40,TAB:9,SHIFT:16,CTRL:17,ALT:18,SPACE:32,ALTGR:0,LT:188,"<":188,GT:190,">":190,SLASH:191,"/":191,'"':222,DBLQUOTE:222,"!":49,"(":57,")":48,"=":187,EQUAL:187,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,ENTER:13,BACKSPACE:8,ESCAPE:27,ESC:27,SUPR:46,
REPAG:33,AVPAG:34,START:36,END:35,NUMLOCK:144,UPPERLOCK:20,A:65,a:65,B:66,b:66,C:67,c:67,D:68,d:68,E:69,e:69,F:70,f:70,G:71,g:71,H:72,h:72,I:73,i:73,J:74,j:74,K:75,k:75,L:76,l:76,M:77,m:77,N:78,n:78,O:79,o:79,P:80,p:80,Q:81,q:81,R:82,r:82,S:83,s:83,T:84,t:84,U:85,u:85,V:86,v:86,W:87,w:87,X:88,x:88,Y:89,y:89,Z:90,z:90};jslash.MOUSE={MOUSEDOWN:"mousedown",MOUSEMOVE:"mousemove",MOUSEUP:"mouseup",CLICK:"click"};jslash.colorkey=new jslash.Color(0,255,0);jslash.byId=function(a){return document.getElementById(a)};
jslash.start=function(a){function b(a){c.onupdate&&(c.onupdate(a-e),e=a);if(c.onclear)c.onclear();if(c.onrefresh)c.onrefresh();w&&d(b)}var c=this,e=(new Date).getTime(),d=D();if(f(a))this.borders=new jslash.BorderedRectangle(0,0,a.width(),a.height()),this.mix(this.borders,new this.behaviors.Collidable(jslash.BorderedRectangle));w=true;d(b)};jslash.stop=function(){w=false};jslash.addKeyEvent=function(a,b){a in n||(n[a]=[]);n[a].push(b);E()};jslash.deepcopy=function(a){var b=new a.constructor,c;for(c in a)a.hasOwnProperty(c)&&
(b[c]=a[c]);return b};jslash.each=function(a,b){if(a instanceof Array)for(var c=0;c<a.length;c++)b(c,a[c]);else if(typeof a=="object")for(c in a)typeof a[c]!="function"&&a.hasOwnProperty(c)&&b(c,a[c])};jslash.map=function(a,b){if(a instanceof Array){for(var c=[],e=0;e<a.length;e++)c.push(b(e,a[e]));return c}else if(typeof a=="object"){var c={},d;for(d in a)typeof a[d]!="function"&&a.hasOwnProperty(d)&&(e=b(d,a[d]),c[d]=e);return c}};jslash.extend=d;jslash.mix=function(a,b){for(var c in b)b.hasOwnProperty(c)&&
(a[c]=b[c])};jslash.times=function(a,b){for(var c=0;c<a;c++)b()};jslash.any=function(a,b){if(a instanceof Array){for(var c=0;c<a.length;c++)if(b(c,a[c]))return true;return false}else if(typeof a=="object"){for(c in a)if(typeof a[c]!="function"&&a.hasOwnProperty(c)&&b(c,a[c]))return true;return false}};jslash.all=function(a,b){if(a instanceof Array){for(var c=0;c<a.length;c++)if(!b(c,a[c]))return false;return true}else if(typeof a=="object"){for(c in a)if(typeof a[c]!="function"&&a.hasOwnProperty(c)&&
!b(c,a[c]))return false;return true}};jslash.prefetchImg=function(a){if(!f(this.images))this.images={};typeof a=="string"&&(a=[a]);var b=this;jslash.each(a,function(a,e){v++;var d=new Image;d.src=e;d.addEventListener("load",function(){u++});b.images[e]=d})};jslash.prefetchAudioSources=function(a){typeof a=="string"&&(a=[a]);jslash.each(a,function(a,c){var e=new Audio;e.src=c;v++;e.addEventListener("load",function(){u++},true)})};jslash.properties=function(a){var b=[],c;for(c in a)a.hasOwnProperty(c)&&
b.push(c);return b};jslash.isDefined=f;jslash.values=function(a){return this.properties(a).map(function(b){return a[b]})};jslash.sliceImg=function(a,b){for(var c=[],e=b.y;e<a.height;e+=b.height)for(var d=b.x;d<a.width;d+=b.width)c.push(new this.Frame(a,new this.Rectangle(d,e,b.width,b.height)));return c};jslash.ready=function(a){window.addEventListener("load",a,true)};jslash.domReady=function(a){window.addEventListener("DOMContentLoaded",a,true)};jslash.hasAuxiliarCanvas=function(){return f(m)};var l=
{mul:function(a,b){return Math.floor(a*b)},div:function(a,b){return Math.floor(a/b)}};jslash.behaviors={};var G=function(a){var b,c;c=this.position();b=c.x;c=c.y;b+=this.speed.x*a/1E3;c+=this.speed.y*a/1E3;this.position(b,c)},H=function(a){var b=this._boundProperty?this[this._boundProperty]:this,c=a._boundProperty?a[a._boundProperty]:a,b=typeof b!="function"?b:b.apply(this),c=typeof c!="function"?c:c.apply(a);if(a=this.shape.collide(b,c)){if(b.oncollides)b.oncollides(c);if(c.oncollides)c.oncollides(b)}return a},
I=function(a){var b,c,e,d,f;c=this.position();b=c.x;c=c.y;b+=this.speed.x*a/1E3;c+=this.speed.y*a/1E3;a=this.region.x;e=this.region.y;d=a+this.region.width;f=e+this.region.height;b<a&&(b=a);c<e&&(c=e);b>d&&(b=d);c>f&&(c=f);this.position(b,c)};jslash.behaviors.Movable=function(a,b){this.speed={x:a,y:b};this.move=G};jslash.behaviors.Collidable=function(a,b){this.shape=a;this._boundProperty=b;this.collides=H};jslash.behaviors.LimitedMovable=function(a,b,c){this.speed={x:a,y:b};this.region=c;this.move=
I};window.addEventListener("load",function(){},true);jslash.net={};jslash.net.Request=function(a,b){this.src=f(a)?a:"";this.method=f(b)?b.toUpperCase():"GET";this._xhr=new XMLHttpRequest};jslash.net.Request.prototype.send=function(a,b){this.method=this.method.toUpperCase();var c=this._xhr,d,g;if(f(b)){if(b instanceof Function)g=b;else throw Error("if second parameter is specified must be a Function");f(a)&&typeof a=="object"&&(d=a)}else g=a;var h=this.src;f(d)&&this.method=="GET"&&(h+="?"+B(d));c.open(this.method,
h,true);c.onreadystatechange=function(){c.readyState==4&&g(c.responseText)};h=null;this.method=="POST"&&(c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),f(d)&&(h=B(d)));c.send(h)}})();(function(){jslash.shapes={};jslash.shapes.Rectangle=function(d,i,g,k,p){this.x=d;this.y=i;this.width=g;this.height=k;this.color=jslash.isDefined(p)?p:new jslash.Color(0,0,0);this._filled=true};jslash.shapes.Rectangle.prototype.stroke=function(d){this._strokeSize=d;this._filled=false};jslash.shapes.Rectangle.prototype.fill=function(){this._filled=true};jslash.shapes.Rectangle.prototype.draw=function(d){this._filled?(d.fillStyle=this.color.toString(),d.fillRect(this.x,this.y,this.width,this.height)):
(d.strokeStyle=this.color.toString(),d.lineWidth=this._strokeSize,d.strokeRect(this.x,this.y,this.width,this.height))};jslash.shapes.Rectangle.prototype.toSizeable=function(){var d=this;return{width:function(){return d.width},height:function(){return d.height}}};jslash.shapes.Circle=function(d,i,g,k){this.center_x=d;this.center_y=i;this.radius=g;this.color=jslash.isDefined(k)?k:new jslash.Color(0,0,0);this._filled=true};jslash.shapes.Circle.prototype.stroke=function(d){this._strokeSize=d;this._filled=
false};jslash.shapes.Circle.prototype.fill=function(){this._filled=true};jslash.shapes.Circle.prototype.draw=function(d){d.beginPath();d.arc(this.center_x,this.center_y,this.radius,0,2*Math.PI,0);this._filled?(d.fillStyle=this.color.toString(),d.fill()):(d.strokeStyle=this.color.toString(),d.lineWidth=this._strokeSize,d.stroke());d.closePath()};jslash.shapes.Line=function(d,i,g,k){this.from=d;this.to=i;this.color=jslash.isDefined(g)?g:new jslash.Color(0,0,0);this.width=jslash.isDefined(k)?k:1};jslash.shapes.Line.prototype.draw=
function(d){d.save();d.fillStyle=this.color.toString();d.lineWidth=this.width;d.beginPath();d.moveTo(this.from.x,this.from.y);d.lineTo(this.to.x,this.to.y);d.closePath();d.stroke();d.restore()}})();
